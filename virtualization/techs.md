# 全虚拟化、半虚拟化和硬件辅助虚拟化

## 基本概念
- **全虚拟化**  
  - 客户机 OS 无需修改，完全模拟硬件环境。  
  - 性能依赖于软件模拟或硬件辅助。  
  - QEMU 使用动态二进制翻译实现。

- **半虚拟化**  
  - 需要修改客户机操作系统，替换敏感指令为 Hypercall。  
  - 通过与 Hypervisor 协作提升性能。  
  - 典型例子：Xen 的半虚拟化。

- **硬件辅助虚拟化**  
  - 利用 CPU 虚拟化扩展（Intel VT-x、AMD-V等）。  
  - 允许客户机代码直接在硬件上运行，减少模拟开销。  
  - KVM 就是基于硬件辅助虚拟化。

## 半虚拟化与硬件辅助虚拟化的关系
- 两者是**正交**的技术。
- 可结合使用，半虚拟化驱动优化 I/O，硬件辅助执行客户机代码。

## 半虚拟化需要客户机修改体现在
- 操作系统内核需要加入 Hypercall 接口，替换敏感指令。
- 设备驱动替换为半虚拟化驱动（如 virtIO），提升性能。
- 从应用开发角度，一般不需要特殊处理，内核修改透明给用户。

## Hypercall 与系统调用区别
- 系统调用：客户机程序调用客户机内核服务（如 svc #0 指令触发ARM系统调用）。
- Hypercall：客户机内核调用Hypervisor接口，进行虚拟化相关操作。
- 半虚拟化通过Hypercall实现客户机与Hypervisor通信。

