# QEMU 与 KVM

## 什么是 QEMU 和 KVM？
- **QEMU**：一个用户态虚拟机监控器（Hypervisor），支持完全软件模拟CPU指令和设备，能实现跨架构虚拟化。
- **KVM**：Linux内核模块，将CPU硬件虚拟化能力暴露给用户态，提供接近裸机的虚拟化性能。


## QEMU 和 KVM的关系
- QEMU 负责设备模拟、客户机系统管理及指令转换。
- KVM 负责利用 CPU 硬件虚拟化指令，直接在内核态执行客户机代码，极大提升性能。
- 启用 KVM 时，QEMU 通过系统调用与 KVM 通信，把 CPU 执行权交给 KVM。

## QEMU 和 KVM 各自作用
- QEMU：
  - 设备模拟（磁盘、网络、显卡等）
  - CPU 指令的动态二进制翻译（未启用 KVM 时）
  - 管理虚拟机生命周期、内存映射
- KVM：
  - 利用CPU虚拟化扩展（Intel VT-x、AMD-V）
  - 内核态高速执行客户机代码
  - 管理客户机特权级和虚拟 CPU 状态

### 如果没有 QEMU 或 KVM
- 没有 KVM：QEMU 只能通过纯软件模拟执行指令，性能极差。
- 没有 QEMU：缺少用户态的设备模拟和管理，无法完整提供虚拟化环境。

> 把运行虚拟机比作开汽车：
>
> KVM 是发动机（加速器，提供计算力）；
> QEMU 是汽车控制系统（方向盘、仪表盘、油门、挡位）；
>
> 没有 KVM，车只能靠人推；
> 没有 QEMU，车虽有发动机，但你连方向盘都没有。

## QEMU 是不是 Hypervisor？
- QEMU 本身是虚拟机管理器和模拟器，不是传统意义的内核态 Hypervisor。
- KVM 才是真正内核态的 Hypervisor。

## QEMU 虚拟化依赖宿主系统调用
- QEMU 运行在用户态，不直接操作硬件。
- QEMU 所有硬件操作都通过宿主操作系统系统调用完成（文件操作、网络、内存分配等）。